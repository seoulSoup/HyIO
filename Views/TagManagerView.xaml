<UserControl x:Class="HyIO.Views.TagManagerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="800">

    <!-- 메인 DataGrid -->
    <DataGrid x:Name="TagGrid"
                Grid.Row="0"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                HeadersVisibility="Column"
                GridLinesVisibility="None"
                RowHeaderWidth="0"
                SelectionMode="Single"
                SelectionUnit="FullRow"
                Background="#FFFAE9DE"
                BorderThickness="0"
                Margin="8,4,0,0">

        <DataGrid.Resources>
            <SolidColorBrush x:Key="RowSelectedBackground" Color="#E0EAFF"/>  <!-- 연파랑 -->
            <SolidColorBrush x:Key="RowSelectedForeground" Color="#111827"/>  <!-- 진회색 텍스트 -->
        </DataGrid.Resources>

        <!-- ✅ Row 선택 스타일 -->
        <DataGrid.RowStyle>
            <Style TargetType="DataGridRow">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{StaticResource AppTextPrimaryBrush}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Margin" Value="0,2,0,2"/>
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{StaticResource RowSelectedBackground}"/>
                        <Setter Property="Foreground" Value="{StaticResource RowSelectedForeground}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </DataGrid.RowStyle>

        <!-- 1) 헤더 스타일: 폰트 16, 연보라 배경 -->
        <DataGrid.ColumnHeaderStyle>
            <Style TargetType="DataGridColumnHeader">
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="FontFamily" Value="{StaticResource AppFontFamily}"/>
                <Setter Property="Foreground" Value="{StaticResource AppTextPrimaryBrush}"/>
                <Setter Property="Background" Value="#EDE9FE"/>  <!-- 연보라 -->
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="Padding" Value="8,4"/>
                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                <Setter Property="BorderBrush" Value="#FFD4CCFF"/>
            </Style>
        </DataGrid.ColumnHeaderStyle>

        <!-- 셀 폰트 기본값 -->
        <DataGrid.CellStyle>
            <Style TargetType="DataGridCell">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontFamily" Value="{StaticResource AppFontFamily}"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="4,2"/>
                <Setter Property="Foreground" Value="{StaticResource AppTextPrimaryBrush}"/>
                <Style.Triggers>
                    <!-- ✅ 선택돼도 셀 내부 글자색은 그대로 유지 -->
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Foreground" Value="{StaticResource AppTextPrimaryBrush}"/>
                        <!-- 셀 배경은 투명으로 두고 Row 배경만 사용 -->
                        <Setter Property="Background" Value="Transparent"/>
                    </Trigger>
                </Style.Triggers>
        </Style>
        </DataGrid.CellStyle>

        <DataGrid.Columns>

            <!-- 2-1) 이미지 열 -->
            <DataGridTemplateColumn Header="이미지" Width="80">
                <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                        <Image Source="{Binding Thumbnail}"
                                Width="64" Height="64"
                                Stretch="UniformToFill"
                                SnapsToDevicePixels="True"/>
                    </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <!-- 2-2) 파일 경로 열 -->
            <DataGridTextColumn Header="파일 이름"
                                Width="2*"
                                Binding="{Binding FileName}">
                <DataGridTextColumn.ElementStyle>
                    <Style TargetType="TextBlock">
                        <Setter Property="TextWrapping" Value="Wrap"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="FontFamily" Value="{StaticResource AppFontFamily}"/>
                    </Style>
                </DataGridTextColumn.ElementStyle>
            </DataGridTextColumn>

            <!-- 2-3, 3, 4) 태그 열 -->
            <DataGridTemplateColumn Header="태그" Width="2*">
                <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel>

                            <!-- 3) 둥근 텍스트박스: 새 태그 입력 후 Enter -->
                            <Border CornerRadius="12"
                                    Background="{StaticResource AppSurfaceAltBrush}"
                                    Padding="8,2"
                                    Margin="6">
                                <TextBox Text="{Binding NewTagText, UpdateSourceTrigger=PropertyChanged}"
                                        BorderThickness="0"
                                        Background="Transparent"
                                        FontSize="14"
                                        FontFamily="{StaticResource AppFontFamily}"
                                        Foreground="{StaticResource AppTextSecondaryBrush}" 
                                        KeyDown="TagTextBox_KeyDown"
                                        GotFocus="TagInput_GotFocus"                        
                                        LostFocus="TagInput_LostFocus"/>                    
                            </Border>

                            <!-- 이미 입력된 태그 칩들 -->
                            <ItemsControl ItemsSource="{Binding Tags}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- 태그 하나 -->
                                        <Border Background="#EDE9FE"
                                                CornerRadius="12"
                                                Margin="6,0,4,4"
                                                Padding="6,2">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding}"
                                                            FontSize="13"
                                                            Margin="0,0,4,0"
                                                            FontFamily="{StaticResource AppFontFamily}"/>

                                                <!-- 4) X 버튼: 태그 삭제 -->
                                                <Button Width="16" Height="16"
                                                        Padding="0"
                                                        CommandParameter="{Binding}"
                                                        Click="RemoveTagButton_Click"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        Cursor="Hand">
                                                    <TextBlock Text="✕"
                                                                FontSize="11"
                                                                VerticalAlignment="Center"
                                                                HorizontalAlignment="Center"
                                                                Foreground="{StaticResource AppTextSecondaryBrush}"/>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                        </StackPanel>
                    </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

        </DataGrid.Columns>
    </DataGrid>
</UserControl>
